import boto3
import zipfile
import os

def handler(s3_file_key):
    s3 = boto3.client("s3")
    bucket = "autosecurex-inputs"

    # Download to /tmp
    local_zip = "/tmp/project.zip"
    s3.download_file(bucket, s3_file_key, local_zip)

    # Unzip contents to /tmp/project/
    project_dir = "/tmp/project/"
    with zipfile.ZipFile(local_zip, 'r') as zip_ref:
        zip_ref.extractall(project_dir)

    # Read a sample Java file (demo purpose)
    sample_code = ""
    for root, dirs, files in os.walk(project_dir):
        for f in files:
            if f.endswith(".java"):
                with open(os.path.join(root, f)) as file:
                    sample_code = file.read()
                    break
        if sample_code: break

    return {
        "project_code_sample": sample_code or "No Java file found."
    }
